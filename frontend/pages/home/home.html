<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>VipTon - Premium TON Mining Platform</title>

    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- VipTon Styles -->
    <style>
        /* CSS Variables */
        :root {
            --vipton-gold: #FFD700;
            --vipton-gold-light: #FFF59D;
            --vipton-gold-dark: #FFC107;
            --vipton-black: #000000;
            --vipton-gray-dark: #1C1C1E;
            --vipton-gray: #2C2C2E;
            --vipton-gray-light: #3A3A3C;
            --vipton-text-primary: #FFFFFF;
            --vipton-text-secondary: #8E8E93;
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: var(--vipton-black);
            color: var(--vipton-text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Container */
        .vipton-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .vipton-header {
            background: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
            padding: 12px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .vipton-header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .vipton-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .vipton-logo {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--vipton-gold), var(--vipton-gold-dark));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 16px;
            color: var(--vipton-black);
        }

        .vipton-balance {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: var(--vipton-gold);
        }

        .vipton-user-badge {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--vipton-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--vipton-gold);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .vipton-user-badge:hover {
            transform: scale(1.05);
        }

        /* Main Content */
        .vipton-main {
            flex: 1;
            padding: 20px;
            padding-bottom: 80px;
            overflow-y: auto;
        }

        .vipton-welcome-user {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 24px;
        }

        /* Stats Grid */
        .vipton-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .vipton-stat-card {
            background: rgba(28, 28, 30, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .vipton-stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.5), transparent);
        }

        .vipton-stat-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .vipton-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--vipton-gold);
            margin-bottom: 4px;
        }

        .vipton-stat-label {
            font-size: 14px;
            color: var(--vipton-text-secondary);
        }

        /* Action Buttons */
        .vipton-action-buttons {
            display: grid;
            gap: 12px;
        }

        .vipton-action-btn {
            padding: 16px;
            background: rgba(28, 28, 30, 0.9);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 14px;
            color: var(--vipton-text-primary);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
        }

        .vipton-action-btn:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
        }

        .vipton-action-btn.primary {
            background: linear-gradient(135deg, var(--vipton-gold), var(--vipton-gold-dark));
            color: var(--vipton-black);
            border: none;
        }

        .vipton-action-btn.primary:hover {
            box-shadow: 0 8px 24px rgba(255, 215, 0, 0.3);
        }

        /* Bottom Navigation */
        .vipton-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(28, 28, 30, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 215, 0, 0.1);
            padding: 8px 0;
            z-index: 100;
        }

        .vipton-nav-items {
            display: flex;
            justify-content: space-around;
        }

        .vipton-nav-item {
            flex: 1;
            padding: 8px;
            background: none;
            border: none;
            color: var(--vipton-text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .vipton-nav-item.active {
            color: var(--vipton-gold);
        }

        .vipton-nav-icon {
            font-size: 24px;
        }

        .vipton-nav-label {
            font-size: 11px;
            font-weight: 600;
        }

        /* Loading State */
        .vipton-loading {
            position: fixed;
            inset: 0;
            background: var(--vipton-black);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .vipton-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(255, 215, 0, 0.1);
            border-top-color: var(--vipton-gold);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .vipton-loading-text {
            margin-top: 20px;
            color: var(--vipton-text-secondary);
        }

        /* Welcome Screen */
        .vipton-welcome {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }

        .vipton-logo-large {
            width: 120px;
            height: 120px;
            margin: 0 auto 32px;
            background: linear-gradient(135deg, var(--vipton-gold), var(--vipton-gold-dark));
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: 800;
            color: var(--vipton-black);
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.3);
        }

        .vipton-welcome-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .vipton-welcome-subtitle {
            font-size: 18px;
            color: var(--vipton-text-secondary);
            margin-bottom: 48px;
        }

        .vipton-auth-btn {
            width: 100%;
            max-width: 300px;
            padding: 18px;
            background: linear-gradient(135deg, var(--vipton-gold), var(--vipton-gold-dark));
            color: var(--vipton-black);
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .vipton-auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(255, 215, 0, 0.5);
        }

        /* Hidden by default */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="vipton-loading">
        <div class="vipton-spinner"></div>
        <div class="vipton-loading-text">Initializing VipTon...</div>
    </div>

    <!-- Welcome Screen (for non-authenticated users) -->
    <div id="welcome-screen" class="vipton-welcome hidden">
        <div class="vipton-logo-large">VT</div>
        <h1 class="vipton-welcome-title">VipTon</h1>
        <p class="vipton-welcome-subtitle">Premium TON Mining Platform</p>
        <button id="auth-btn" class="vipton-auth-btn">Login with Telegram</button>
    </div>

    <!-- Main App -->
    <div id="app" class="vipton-container hidden">
        <!-- Header -->
        <header class="vipton-header">
            <div class="vipton-header-content">
                <div class="vipton-header-left">
                    <div class="vipton-logo">VT</div>
                    <div class="vipton-balance">
                        💰 <span id="ton-balance">0.00</span> TON
                    </div>
                    <div id="vip-badge" class="hidden">
                        👑 VIP <span id="vip-level">1</span>
                    </div>
                </div>
                <div id="user-avatar" class="vipton-user-badge">?</div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="vipton-main">
            <!-- Home Tab -->
            <div id="tab-home" class="tab-content">
                <h1 class="vipton-welcome-user">Welcome, <span id="user-name">User</span>! 👋</h1>

                <div class="vipton-stats-grid">
                    <div class="vipton-stat-card">
                        <div class="vipton-stat-icon">💰</div>
                        <div class="vipton-stat-value" id="stat-balance">0.00</div>
                        <div class="vipton-stat-label">TON Balance</div>
                    </div>

                    <div class="vipton-stat-card">
                        <div class="vipton-stat-icon">👑</div>
                        <div class="vipton-stat-value" id="stat-vip">None</div>
                        <div class="vipton-stat-label">VIP Status</div>
                    </div>

                    <div class="vipton-stat-card">
                        <div class="vipton-stat-icon">👥</div>
                        <div class="vipton-stat-value" id="stat-referrals">0</div>
                        <div class="vipton-stat-label">Referrals</div>
                    </div>

                    <div class="vipton-stat-card">
                        <div class="vipton-stat-icon">🚀</div>
                        <div class="vipton-stat-value" id="stat-earned">0</div>
                        <div class="vipton-stat-label">Total Earned</div>
                    </div>
                </div>

                <div class="vipton-action-buttons">
                    <button id="start-mining" class="vipton-action-btn primary">
                        ⛏️ Start Mining
                    </button>
                    <button class="vipton-action-btn">
                        🎁 Daily Reward
                    </button>
                    <button class="vipton-action-btn">
                        📊 View Tasks
                    </button>
                </div>
            </div>

            <!-- Mining Tab -->
            <div id="tab-mining" class="tab-content hidden">
                <h2>Mining</h2>
                <p style="color: #8E8E93;">Mining features coming soon...</p>
            </div>

            <!-- Tasks Tab -->
            <div id="tab-tasks" class="tab-content hidden">
                <h2>Tasks</h2>
                <p style="color: #8E8E93;">Complete tasks to earn more TON</p>
            </div>

            <!-- Referrals Tab -->
            <div id="tab-referrals" class="tab-content hidden">
                <h2>Referrals</h2>
                <p style="color: #8E8E93;">Your referral code: <strong id="referral-code">Loading...</strong></p>
            </div>

            <!-- Profile Tab -->
            <div id="tab-profile" class="tab-content hidden">
                <h2>Profile</h2>
                <button id="logout-btn" class="vipton-action-btn" style="margin-top: 20px;">
                    Logout
                </button>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="vipton-nav">
            <div class="vipton-nav-items">
                <button class="vipton-nav-item active" data-tab="home">
                    <span class="vipton-nav-icon">🏠</span>
                    <span class="vipton-nav-label">Home</span>
                </button>

                <button class="vipton-nav-item" data-tab="mining">
                    <span class="vipton-nav-icon">⛏️</span>
                    <span class="vipton-nav-label">Mining</span>
                </button>

                <button class="vipton-nav-item" data-tab="tasks">
                    <span class="vipton-nav-icon">📋</span>
                    <span class="vipton-nav-label">Tasks</span>
                </button>

                <button class="vipton-nav-item" data-tab="referrals">
                    <span class="vipton-nav-icon">👥</span>
                    <span class="vipton-nav-label">Referrals</span>
                </button>

                <button class="vipton-nav-item" data-tab="profile">
                    <span class="vipton-nav-icon">👤</span>
                    <span class="vipton-nav-label">Profile</span>
                </button>
            </div>
        </nav>
    </div>

    <!-- VipTon JavaScript -->
    <script>
        // VipTon App
        const VipTonApp = {
            // Configuration
            config: {
                apiUrl: window.location.origin + '/api',
                authEndpoint: '/auth/telegram',
                verifyEndpoint: '/auth/verify',
                profileEndpoint: '/auth/profile',
                vipStatusEndpoint: '/auth/vip-status'
            },

            // State
            state: {
                isAuthenticated: false,
                user: null,
                token: null,
                vipStatus: null
            },

            // Initialize
            init() {
                console.log('🚀 Initializing VipTon...');

                // Initialize Telegram Web App
                if (window.Telegram?.WebApp) {
                    const tg = window.Telegram.WebApp;
                    tg.ready();
                    tg.expand();
                    tg.setHeaderColor('#000000');
                    tg.setBackgroundColor('#000000');

                    // Save Telegram instance
                    this.telegram = tg;

                    console.log('📱 Telegram Web App initialized');
                }

                // Check saved session
                this.checkSession();

                // Setup event listeners
                this.setupEventListeners();
            },

            // Check session
            async checkSession() {
                const savedToken = localStorage.getItem('vipton_token');
                const savedUser = localStorage.getItem('vipton_user');

                if (savedToken && savedUser) {
                    this.state.token = savedToken;
                    this.state.user = JSON.parse(savedUser);

                    // Verify token
                    const isValid = await this.verifyToken();

                    if (isValid) {
                        this.state.isAuthenticated = true;
                        this.showApp();
                        return;
                    }
                }

                // Try to authenticate with Telegram
                if (this.telegram?.initData) {
                    await this.authenticate();
                } else {
                    this.showWelcome();
                }
            },

            // Authenticate
            async authenticate() {
                console.log('🔐 Authenticating...');

                try {
                    const response = await fetch(this.config.apiUrl + this.config.authEndpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            initData: this.telegram.initData
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        // Save auth data
                        this.state.token = data.data.token;
                        this.state.user = data.data.user;
                        this.state.isAuthenticated = true;

                        // Save to localStorage
                        localStorage.setItem('vipton_token', data.data.token);
                        localStorage.setItem('vipton_user', JSON.stringify(data.data.user));

                        console.log('✅ Authentication successful');
                        this.showApp();
                    } else {
                        console.error('❌ Authentication failed:', data.error);
                        this.showWelcome();
                    }
                } catch (error) {
                    console.error('❌ Authentication error:', error);
                    this.showWelcome();
                }
            },

            // Verify token
            async verifyToken() {
                try {
                    const response = await fetch(this.config.apiUrl + this.config.verifyEndpoint, {
                        headers: {
                            'Authorization': `Bearer ${this.state.token}`
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success && data.data?.user) {
                            this.state.user = data.data.user;
                            localStorage.setItem('vipton_user', JSON.stringify(data.data.user));
                        }
                        return data.success;
                    }
                    return false;
                } catch (error) {
                    console.error('Token verification error:', error);
                    return false;
                }
            },

            // Get VIP status
            async getVipStatus() {
                if (!this.state.token) return;

                try {
                    const response = await fetch(this.config.apiUrl + this.config.vipStatusEndpoint, {
                        headers: {
                            'Authorization': `Bearer ${this.state.token}`
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            this.state.vipStatus = data.data;
                            this.updateVipDisplay();
                        }
                    }
                } catch (error) {
                    console.error('VIP status error:', error);
                }
            },

            // Show app
            showApp() {
                document.getElementById('loading-screen').classList.add('hidden');
                document.getElementById('welcome-screen').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');

                // Update UI
                this.updateUserDisplay();
                this.getVipStatus();
            },

            // Show welcome
            showWelcome() {
                document.getElementById('loading-screen').classList.add('hidden');
                document.getElementById('welcome-screen').classList.remove('hidden');
                document.getElementById('app').classList.add('hidden');
            },

            // Update user display
            updateUserDisplay() {
                if (!this.state.user) return;

                // Update name
                document.getElementById('user-name').textContent =
                    this.state.user.first_name || this.state.user.username || 'User';

                // Update avatar
                const avatar = document.getElementById('user-avatar');
                avatar.textContent = (this.state.user.first_name || 'U').charAt(0).toUpperCase();

                // Update stats
                const balance = this.state.user.ton_balance || 0;
                document.getElementById('ton-balance').textContent = balance.toFixed(2);
                document.getElementById('stat-balance').textContent = balance.toFixed(2);
                document.getElementById('stat-referrals').textContent = this.state.user.total_referrals || 0;
                document.getElementById('stat-earned').textContent = this.state.user.total_earned || 0;

                // Update referral code
                document.getElementById('referral-code').textContent =
                    this.state.user.referral_code || 'Not available';
            },

            // Update VIP display
            updateVipDisplay() {
                if (!this.state.vipStatus) return;

                if (this.state.vipStatus.is_vip) {
                    document.getElementById('vip-badge').classList.remove('hidden');
                    document.getElementById('vip-level').textContent = this.state.vipStatus.vip_level;
                    document.getElementById('stat-vip').textContent = `Level ${this.state.vipStatus.vip_level}`;
                } else {
                    document.getElementById('stat-vip').textContent = 'None';
                }
            },

            // Logout
            logout() {
                localStorage.removeItem('vipton_token');
                localStorage.removeItem('vipton_user');
                this.state.isAuthenticated = false;
                this.state.user = null;
                this.state.token = null;
                this.showWelcome();
            },

            // Setup event listeners
            setupEventListeners() {
                // Auth button
                const authBtn = document.getElementById('auth-btn');
                if (authBtn) {
                    authBtn.addEventListener('click', () => this.authenticate());
                }

                // Navigation
                const navItems = document.querySelectorAll('.vipton-nav-item');
                navItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        const tab = item.dataset.tab;
                        this.switchTab(tab);

                        // Update active state
                        navItems.forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                    });
                });

                // Mining button
                const miningBtn = document.getElementById('start-mining');
                if (miningBtn) {
                    miningBtn.addEventListener('click', () => {
                        const isActive = miningBtn.textContent.includes('Active');
                        miningBtn.textContent = isActive ? '⛏️ Start Mining' : '⛏️ Mining Active...';
                        miningBtn.style.background = isActive ? '' : 'linear-gradient(135deg, #10B981, #059669)';
                    });
                }

                // Logout button
                const logoutBtn = document.getElementById('logout-btn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', () => {
                        if (confirm('Are you sure you want to logout?')) {
                            this.logout();
                        }
                    });
                }
            },

            // Switch tab
            switchTab(tabName) {
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.add('hidden');
                });

                // Show selected tab
                const selectedTab = document.getElementById(`tab-${tabName}`);
                if (selectedTab) {
                    selectedTab.classList.remove('hidden');
                }
            }
        };

        // Initialize app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => VipTonApp.init());
        } else {
            VipTonApp.init();
        }
    </script>
</body>
</html>